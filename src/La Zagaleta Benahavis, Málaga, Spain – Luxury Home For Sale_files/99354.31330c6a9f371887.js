"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[99354],{99354:function(e,t,a){a.r(t),a.d(t,{default:function(){return v}});var r=a(85893),i=a(67294),n=a(64418),s=a(91752);let l=(0,s.G)().SiteSettings().IdWebsite,o={IsInitialized:!1,CRMLeadServiceUrl:null,IdUser:null,RecordType:null,Initialize(e,t,a){switch(this.CRMLeadServiceUrl=e,this.IdUser=t,a){case"listings":case"listingdetails":case"listingscompare":this.RecordType="Listing";break;case"associates":case"associatedetails":this.RecordType="Agent";break;case"agentwebsite":this.RecordType="AgentWebsite";break;case"homepage":break;case"brokers":case"brokerdetails":this.RecordType="Broker"}""!==this.CRMLeadServiceUrl&&(this.IsInitialized=!0)},SubmitLead(e){if(!this.IsInitialized||(null==e?void 0:e.EventData)===null||void 0===(null==e?void 0:e.EventData)||null===e.EventData.ReportedId||void 0===e.EventData.ReportedId||null===e.EventData.UserName||void 0===e.EventData.UserName||null===e.EventData.UserEmail||void 0===e.EventData.UserEmail||null===e.EventData.IdWebsite||void 0===e.EventData.IdWebsite)return;let t="",a="",r="";null!==e.ExtraParams&&void 0!==e.ExtraParams&&((t=void 0!==e.ExtraParams.phone?e.ExtraParams.phone:"")==='"'.concat((0,n.X)("global:phone number"),'"')&&(t=""),a=void 0!==e.ExtraParams.idAccount?e.ExtraParams.idAccount:"",r=void 0!==e.ExtraParams.receiptId?e.ExtraParams.receiptId:"");try{fetch("".concat(this.CRMLeadServiceUrl,"/crmsubmitlead"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({RecordId:e.EventData.ReportedId,UserName:e.EventData.UserName,UserEmail:e.EventData.UserEmail,UserMessage:e.EventData.UserMessage,UserPhone:t,PreferredContactMethod:"",DateTime1:e.EventData.AvailableDate1,DateTime2:e.EventData.AvailableDate2,DateTime3:e.EventData.AvailableDate3,Referrer:window.location.href,RecipientAgentId:e.EventData.AgentId,RecordType:this.RecordType,IdWebsite:e.EventData.IdWebsite,IdUser:this.IdUser,AppointmentType:e.EventData.AppointmentType,IdAccount:a,ReceiptId:r})}).then(()=>{}).catch(e=>{console.log("CRMLeadServiceUrl failed with error: ",e)})}catch(e){console.log("CRMLeadServiceUrl failed with error: ",e)}},LogResponseCode(e){let t;if(!this.IsInitialized||null===e.EventData||void 0===e.EventData)return;let a="";if(null===e.ExtraParams||void 0===e.ExtraParams||""===(a=void 0!==e.ExtraParams.ResponseCode?e.ExtraParams.ResponseCode:""))return;t=void 0!==e.ExtraParams.PostParams?e.ExtraParams.PostParams:null;let r="";if(null!==t)for(let e in t)r+="".concat(e,"=").concat(t[e],";");a+="^".concat(r),fetch("".concat(this.CRMLeadServiceUrl,"/crmsubmiterrorcode"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ResponseCode:a,IdWebsite:l})}).then(()=>{}).catch(e=>{throw e})},HandleReportingEvents(e){var t;e&&(null==e||null===(t=e.detail)||void 0===t||t.reportObjectArray.forEach(e=>{let t=e.Event.name;switch(t){case"RE.EmailAgentSentReport.EmailAgentSentReport":o.SubmitLead(e);break;case"RE.EmailAgentSentReport.FailedEmailAgentSentReport":o.LogResponseCode(e)}}))}};var d=a(13307);let c=e=>{let{CRMReportingObject:t}=e,a=(0,s.G)().SiteSettings().PageType,n=(null==t?void 0:t.registereduserid)?null==t?void 0:t.registereduserid:0;return(0,i.useEffect)(()=>{"function"==typeof d.tE&&(o.IdUser=n,o.CRMLeadServiceUrl=(null==t?void 0:t.serviceurl)?null==t?void 0:t.serviceurl:"undefined",o.RecordType=a||"undefined",o.Initialize(null==t?void 0:t.serviceurl,n,a),(0,d.tE)(o.HandleReportingEvents))},[]),(0,r.jsx)(r.Fragment,{children:null})};var v=c}}]);